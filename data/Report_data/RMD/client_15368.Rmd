---
title: 
author:
date:
output: pdf_document
params: 
  args: "myarg"
  args1: "crop"
header-includes:
- \usepackage[utf8]{inputenc}
- \usepackage{xcolor}
- \usepackage{graphicx}
- \usepackage{mathtools}
- \usepackage{geometry}
- \usepackage{fancyhdr}
- \usepackage{url}
- \usepackage{titling}
- \usepackage{multirow}
- \usepackage{colortbl}
- \usepackage{tabularray}
- \usepackage{array, makecell, multirow}
- \usepackage{caption}
- \definecolor{maincolorLight}{HTML}{838fbc}
- \definecolor{maincolorMedium}{HTML}{425b9b}
- \definecolor{maincolorDark}{HTML}{003d80}
- \definecolor{Color2}{HTML}{006400}
- \definecolor{color3}{HTML}{00008B}
---

```{r echo=FALSE,warning=FALSE, message=FALSE}
args <- commandArgs(trailingOnly = TRUE)
library(profvis)
library(tibble)
library(dplyr, warn.conflicts = FALSE)
library(tidygeocoder)

in.filename <- params$args
crop <- params$args1
# in.filename <- "28630"

# in.glob <- Sys.glob(file.path(dir_file,in.filename))

# Remark Path
# remark.csv <- read.csv("/home/satyukt/Projects/1000/soil_health/data/report_remarks/remarks.csv")
if(crop == "Maize"){
  remark.csv <- read.csv('/home/satyukt/Projects/1000/soil_health/data/Report_data/report_remarks/maize.csv')
} else if(crop == "Green_Gram"){
  remark.csv <-  read.csv('/home/satyukt/Projects/1000/soil_health/data/Report_data/report_remarks/green_gram.csv')
} else{
  remark.csv <- read.csv("/home/satyukt/Projects/1000/soil_health/data/Report_data/report_remarks/remarks.csv")
}


# Get the Farm ID
farm.id <- in.filename

# Read the csv
csv_path <- sprintf("/home/satyukt/Projects/1000/soil_health/output/csv/%s.csv", farm.id)
area_path <- sprintf("/home/satyukt/Projects/1000/area/%s.csv", farm.id)
# area_path <- sprintf("/home/satyukt/Desktop/Manish/wkt_to_shp/create_wkt/area/%s.csv", farm.id)
# csv <- sprintf("%s",in.glob)
# in.csv <- read.csv(sprintf("%s/%s.csv",csv,farm.id))
in.csv <- read.csv(csv_path)

farmdf <- read.csv(area_path, header = FALSE)
unfor_lon_lat <- as.character(farmdf$V2)
lon <- as.double(strsplit(unfor_lon_lat, split = " ")[[1]][2])
lat <- as.double(strsplit(unfor_lon_lat, split = " ")[[1]][3])

data <- tibble(
  latitude = lat,
  longitude = lon
) %>%
  reverse_geocode(
    lat = latitude,
    long = longitude,
    method = "osm",
    full_results = TRUE
  )

# dist = data$address
dist <- data$state_district
state <- data$state
comb <- paste0(dist, ", ", state)

# Png
png_path <- "/home/satyukt/Projects/1000/soil_health/output/png/"


# bound <- sprintf("/home/satyukt/Projects/1000/soil_health/output/Farm Boundary/%s/%s.png", farm.id, farm.id)
N <- sprintf("%s/%s/%s_N.png", png_path, farm.id, farm.id)
P <- sprintf("%s/%s/%s_P.png", png_path, farm.id, farm.id)
K <- sprintf("%s/%s/%s_K.png", png_path, farm.id, farm.id)
OC <- sprintf("%s/%s/%s_OC.png", png_path, farm.id, farm.id)
pH <- sprintf("%s/%s/%s_pH.png", png_path, farm.id, farm.id)
sat_logo <- '/home/satyukt/Projects/1000/soil_health/data/Report_data/logos_15368/satyukt_logo.png'
magi_logo <- '/home/satyukt/Projects/1000/soil_health/data/logos_17684/magicbloom_logo.jpg'
rashtr_logo <- '/home/satyukt/Projects/1000/soil_health/data/Report_data/logos_15368/logo.png'



# Nitrogen values
avg_n <- in.csv$N[1]
min_n <- in.csv$N[2]
max_n <- in.csv$N[3]

# PHosphorus Values
avg_p <- in.csv$P[1]
min_p <- in.csv$P[2]
max_p <- in.csv$P[3]

# Potassium values
avg_k <- in.csv$K[1]
min_k <- in.csv$K[2]
max_k <- in.csv$K[3]

# pH values
avg_ph <- in.csv$pH[1]
min_ph <- in.csv$pH[2]
max_ph <- in.csv$pH[3]

# Soil organic carbon
avg_oc <- in.csv$OC[1]
min_oc <- in.csv$OC[2]
max_oc <- in.csv$OC[3]

# date
date <- in.csv$date[1]

# Standard Ranges
standard_N <- range(280, 560)
standard_P <- range(10, 24)
standard_k <- range(108, 280)
standard_oc <- range(0.5, 0.75)


if (avg_ph <= 5.5) {
  remark_ph <- remark.csv$Generic.Remarks[13]
} else if (avg_ph >= 5.6 & avg_ph <= 6.5) {
  remark_ph <- remark.csv$Generic.Remarks[14]
} else if (avg_ph > 6.5 & avg_ph <= 7.0) {
  remark_ph <- remark.csv$Generic.Remarks[15]
} else if (avg_ph > 7.0 & avg_ph <= 7.5) {
  remark_ph <- remark.csv$Generic.Remarks[16]
} else if (avg_ph > 7.5 & avg_ph <= 8.5) {
  remark_ph <- remark.csv$Generic.Remarks[17]
} else if (avg_ph > 8.5) {
  remark_ph <- remark.csv$Generic.Remarks[18]
}

if (avg_n < standard_N[1]) {
  remark_n <- remark.csv$Generic.Remarks[1]
} else if (avg_n > standard_N[2]) {
  remark_n <- remark.csv$Generic.Remarks[3]
} else {
  remark_n <- remark.csv$Generic.Remarks[2]
}

if (avg_p < standard_P[1]) {
  remark_p <- remark.csv$Generic.Remarks[4]
} else if (avg_p > standard_P[2]) {
  remark_p <- remark.csv$Generic.Remarks[6]
} else {
  remark_p <- remark.csv$Generic.Remarks[5]
}

if (avg_k < standard_k[1]) {
  remark_k <- remark.csv$Generic.Remarks[7]
} else if (avg_k > standard_k[2]) {
  remark_k <- remark.csv$Generic.Remarks[9]
} else {
  remark_k <- remark.csv$Generic.Remarks[8]
}

if (avg_oc < standard_oc[1]) {
  remark_oc <- remark.csv$Generic.Remarks[10]
} else if (avg_oc > standard_oc[2]) {
  remark_oc <- remark.csv$Generic.Remarks[12]
} else {
  remark_oc <- remark.csv$Generic.Remarks[11]
}
```




```{=latex}
\fancypagestyle{plain}{a4paper,inner=12mm,outer=10mm,top=5mm,bottom=15mm,footskip=5mm}
\centering
% \setlength{\droptitle}{-10em}
\title {\LARGE \textcolor{color3}{\textbf{Soil Health Report}}\vspace{-4.5em}}
\date{}
\maketitle 
% \vspace{5px}
\centering \emph{presented by}\\

\includegraphics[width = 6cm,height = 7cm]{`r rashtr_logo`} \\
\centering {\LARGE \textcolor{Color2}{\textbf{Rural Business Hub}}}\\
\vspace{20px}
\centering {\emph{Provided by}}\\
\vspace{10px}
\includegraphics[width = 3cm, height = 3cm]{`r sat_logo`}

\vspace{20px}
\begin{tblr}{
    width = 12cm,
    colspec = {m{6cm} m{6cm}},
    hlines,
    vlines,
    row{1-3}={7ex}}
\centering Farm ID & \centering {`r farm.id`} \\
\centering Date of Satellite pass & \centering {`r date`}\\
\centering Location & \centering {`r comb`} \\
\end{tblr}
\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%

\newpage
```
```{=latex}
\begin{figure}[htp]
 \centering
 \includegraphics[width = 13cm,height = 11cm]{`r N`}
\end{figure}
\vspace{20px}
\definecolor{ballblue}{rgb}{0.13, 0.67, 0.8}
\begin{tblr}{
    width=11cm,
    colspec={ccX},
    hlines,
    vlines,
    cell{2}{3}={r=3}{halign},
    row{1}={ballblue},
    cell{1}{1-3}={cmd=\textbf},
    row{2-4}={10ex}}
Range &Available \newline Nitrogen(kg/ha) & Remarks\\
Average & {`r avg_n`} & {`r remark_n`}\\
Minimum & {`r min_n`} & \\
Maximum & {`r max_n`} & \\
\end{tblr}
\quad
\begin{tblr}{
    width = 4cm,
    colspec = {c},
    hlines,
    vlines,
    row{1}={ballblue},
    row{2} = {yellow},
    row{3} = {red},
    row{4} = {green},
    row{2-4}={10ex}}
\textbf{Standard Soil Testing}\\
280-560 kg/ha (Normal) \\
< 280 kg/ha (low) \\
> 560 kg/ha (High)\\
\end{tblr}
\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%
\newpage

```
```{=latex}
\begin{figure}[htp]
 \centering
 \includegraphics[width = 13cm,height = 11cm]{`r P`}
\end{figure}
\definecolor{ballblue}{rgb}{0.13, 0.67, 0.8}
\vspace{20px}
\begin{tblr}{
    width=11cm,
    colspec={ccX},
    hlines,
    vlines,
    cell{2}{3}={r=3}{halign},
    row{1}={ballblue},
    cell{1}{1-3}={cmd=\textbf},
    row{2-4}={10ex}}
Range & Available \newline Phosphorus(kg/ha) & Remarks\\
Average & {`r avg_p`} & {`r remark_p`}\\
Minimum & {`r min_p`} & \\
Maximum & {`r max_p`} & \\
\end{tblr}
\quad
\begin{tblr}{
    width = 4cm,
    colspec = {c},
    hlines,
    vlines,
    row{1}={ballblue},
    row{2} = {yellow},
    row{3} = {red},
    row{4} = {green},
    row{2-4}={10ex}}
\textbf{Standard Soil Testing}\\
10-24 kg/ha (Normal) \\
< 10 kg/ha (low) \\
> 24 kg/ha (High)\\
\end{tblr}
\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%
\newpage

```

```{=latex}
\begin{figure}[htp]
 \centering
 \includegraphics[width = 13cm,height = 11cm]{`r K`}
\end{figure}
\vspace{20px}
\begin{tblr}{
    width=11cm,
    colspec={ccX},
    hlines,
    vlines,
    cell{2}{3}={r=3}{halign},
    row{1}={ballblue},
    cell{1}{1-3}={cmd=\textbf},
    row{2-4}={10ex}}
Range & Available Potassium(kg/ha) & Remarks\\
Average & {`r avg_k`} & {`r remark_k`}\\
Minimum & {`r min_k`} & \\
Maximum & {`r max_k`} & \\
\end{tblr}
\quad
\begin{tblr}{
    width = 4cm,
    colspec = {c},
    hlines,
    vlines,
    row{1}={ballblue},
    row{2} = {yellow},
    row{3} = {red},
    row{4} = {green},
    row{2-4}={10ex}}
\textbf{Standard Soil Testing}\\
108-280 kg/ha (Normal) \\
< 108 kg/ha (low) \\
> 280 kg/ha (High)\\
\end{tblr}
\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%
\newpage

```
```{=latex}
\begin{figure}[htp]
 \centering
 \includegraphics[width = 13cm,height = 11cm]{`r OC`}
\end{figure}
\vspace{20px}
\begin{tblr}{
    width=11cm,
    colspec={ccX},
    hlines,
    vlines,
    cell{2}{3}={r=3}{halign},
    row{1}={ballblue},
    cell{1}{1-3}={cmd=\textbf},
    row{2-4}={10ex}}
Range & Available \newline Soil Organic Carbon & Remarks\\
Average & {`r avg_oc`}\% & {`r remark_oc`}\\
Minimum & {`r min_oc`}\% & \\
Maximum & {`r max_oc`}\% & \\
\end{tblr}
\quad
\begin{tblr}{
    width = 4cm,
    colspec = {c},
    hlines,
    vlines,
    row{1}={ballblue},
    row{2} = {yellow},
    row{3} = {red},
    row{4} = {green},
    row{2-4}={10ex}}
Standard Soil Testing\\
0.5 - 0.75\% (Normal) \\
< 0.5\% (low) \\
> 0.75\% (High)\\
\end{tblr}
\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%
\newpage
```

```{=latex}
\begin{figure}[htp]
\vspace{20px}
 \centering
 \includegraphics[width = 13cm,height = 11cm]{`r pH`}
\end{figure}
\vspace{20px}
\definecolor{ballblue}{rgb}{0.13, 0.67, 0.8}

\begin{tblr}{
    width=12cm,
    colspec={ccX},
    hlines,
    vlines,
    cell{2}{3}={r=3}{halign},
    row{1}={ballblue},
    cell{1}{1-3}={cmd=\textbf},
    row{2-4}={10ex}}
Range & pH & Remarks\\
Average & {`r avg_ph`} & {`r remark_ph`}\\
Minimum & {`r min_ph`} & \\
Maximum & {`r max_ph`} & \\
\end{tblr}

\vspace{0.5in}
\flushleft \textbf{Disclaimer:}
\begin{footnotesize}
{\flushright \color {red} This is generated on the date when the land was barren.The Figures are based on satellite images with a spatial resolution of 10m*10m. When compared to lab tests, there may be minor differences.The reports are not to be reproduced wholly or in part and cannot be used as evidence in the court of LAW.}
\end{footnotesize}

\thispagestyle{fancy}
\fancyfoot[C]{\\office: 1st Floor, In front of Radha Fuel Services, Gola Road, Mohammadi, Kheri - 262804\\
Contact:+91-8423783393 Email: office.ruralbusinesshub@gmail.com}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{1pt}%

```

